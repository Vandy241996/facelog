# Use lightweight Node image
FROM node:20-alpine

# Set working directory inside container
WORKDIR /app

# Copy root package.json and package-lock.json
COPY package*.json ./

# Copy workspace folders needed (backend + any shared libs if needed)
COPY apps/backend ./apps/backend
COPY apps/frontend ./apps/frontend

# Install all dependencies for all workspaces at once
RUN npm ci --omit=dev

# Expose backend port
EXPOSE 4000

# Start backend app using --prefix to specify workspace
CMD ["npm", "start", "--prefix", "apps/backend"]
